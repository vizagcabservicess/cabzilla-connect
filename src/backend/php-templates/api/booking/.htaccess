
RewriteEngine On

# Set default PHP handler - critical for proper execution
AddHandler application/x-httpd-php .php
SetHandler application/x-httpd-php

# CRITICAL FIX: Fix for booking edit endpoints - multiple formats
RewriteRule ^([0-9]+)/edit/?$ edit.php?id=$1 [QSA,L]
RewriteRule ^edit/([0-9]+)/?$ edit.php?id=$1 [QSA,L]

# CRITICAL FIX: Fix for booking receipt endpoints - multiple formats
RewriteRule ^([0-9]+)/receipt/?$ ../receipt.php?id=$1 [QSA,L]
RewriteRule ^receipt/([0-9]+)/?$ ../receipt.php?id=$1 [QSA,L]

# CRITICAL FIX: Fix for booking cancel endpoints - multiple formats with highest priority
RewriteRule ^cancel$ cancel.php [QSA,L]
RewriteRule ^([0-9]+)/cancel/?$ cancel.php?id=$1 [QSA,L]
RewriteRule ^cancel/([0-9]+)/?$ cancel.php?id=$1 [QSA,L]

# Critical fix - allow direct access to PHP files
<FilesMatch "\.php$">
    RewriteEngine Off
    SetHandler application/x-httpd-php
</FilesMatch>

# Set CORS headers
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    
    # Aggressive cache prevention
    Header always set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header always set Pragma "no-cache"
    Header always set Expires "0"
</IfModule>

# Handle OPTIONS requests for CORS - CRITICAL FIX
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule .* - [R=200,L]

# Direct access fallback for PHP files that don't match other rules
RewriteCond %{REQUEST_URI} \.php$
RewriteRule ^(.*)$ $1 [L]
