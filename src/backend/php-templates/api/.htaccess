
# Enable rewrite engine
RewriteEngine On

# Set PHP error reporting for debugging
php_flag display_errors on
php_value error_reporting E_ALL

# Set higher memory limit and execution time
php_value memory_limit 256M
php_value max_execution_time 300
php_value post_max_size 64M
php_value upload_max_filesize 32M

# Enable PHP mail functionality
php_value sendmail_path "/usr/sbin/sendmail -t -i"
php_flag mail.add_x_header On

# Parse API routes to PHP files
RewriteRule ^signup$ signup.php [L]
RewriteRule ^login$ login.php [L]
RewriteRule ^user/dashboard$ user/dashboard.php [L]
RewriteRule ^booking/create$ book.php [L]
RewriteRule ^book$ book.php [L]
RewriteRule ^book/edit/([0-9]+)$ book-edit.php?id=$1 [L]
RewriteRule ^admin/bookings$ admin/bookings.php [L]
RewriteRule ^fares/tours$ fares/tours.php [L]
RewriteRule ^fares/vehicles$ fares/vehicles.php [L]
RewriteRule ^admin/fares/update$ admin/fares-update.php [L]
RewriteRule ^admin/km-price/update$ admin/km-price-update.php [L]

# Set content type
<FilesMatch "\.(php)$">
    Header set Content-Type "application/json"
</FilesMatch>

# Enable CORS
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Max-Age "3600"
    
    # Prevent caching of API responses
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
</IfModule>

# Handle OPTIONS method for CORS preflight
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule .* - [R=200,L]

# Prevent direct access to .php files
Options -Indexes

# Set higher timeouts for long operations
<IfModule mod_reqtimeout.c>
    RequestReadTimeout header=90 body=300
</IfModule>
